<!doctype html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Цифровой двойник трёхфазного сепаратора</title>
  <link rel="stylesheet" href="css/styles.css">
</head>
<body>
  <div class="page">
    <!-- Левая панель: Управление клапанами -->
    <aside class="sidebar">
      <h2>Управление клапанами</h2>
      <div class="tabs">
        <button class="tab-btn active" data-tab="pressure">Клапан регулятора давления</button>
        <button class="tab-btn" data-tab="water">Клапан регулятора уровня воды в основной камере</button>
        <button class="tab-btn" data-tab="oil">Клапан регулятора уровня нефти в основной камере</button>
      </div>
      
      <!-- Вкладка: Регулятор давления -->
      <div id="pressure" class="tab-content active">
        <div class="control">
          <label>Шкала открытия клапана (Kvs): <span id="kvsVal">0.5</span></label>
          <input type="range" id="kvs" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="control">
          <label>Шкала расхода жидкости Q (м³/сут): <span id="flowVal">100</span></label>
          <input type="range" id="flow" min="100" max="8000" step="10" value="100">
        </div>
        <div class="value-box">
          <span class="label">Давление:</span>
          <span id="pressureOut">0</span>
        </div>
      </div>
      
      <!-- Вкладка: Регулятор воды -->
      <div id="water" class="tab-content">
        <div class="control">
          <label>Степень открытия клапана (К): <span id="waterKVal">0.5</span></label>
          <input type="range" id="waterK" min="0" max="1" step="0.01" value="0.5">
          <small>0 - клапан закрыт, 0.5 - оптимально (наполовину), 1 - полностью открыт</small>
        </div>
        <div class="control">
          <label>Расход жидкости Q (м³/сут): <span id="waterQVal">100</span></label>
          <input type="range" id="waterQ" min="100" max="1000" step="10" value="100">
        </div>
        <div class="value-box large">
          <span class="label">Уровень воды:</span>
          <span id="waterLevel" class="large-value">0 мм</span>
        </div>
      </div>
      
      <!-- Вкладка: Регулятор нефти -->
      <div id="oil" class="tab-content">
        <div class="control">
          <label>Коэффициент пропускной способности (Cv), м³/ч: <span id="oilCvVal">20</span></label>
          <input type="range" id="oilCv" min="0" max="56" step="1" value="20">
        </div>
        <div class="control">
          <label>Перепад давления (ΔP), бар: <span id="oilDpVal">4</span></label>
          <input type="range" id="oilDp" min="0" max="8.5" step="0.1" value="4">
        </div>
        <div class="control">
          <label>Степень открытия клапана (u): <span id="oilUVal">0.5</span></label>
          <input type="range" id="oilU" min="0" max="1" step="0.01" value="0.5">
        </div>
        <div class="value-box">
          <span class="label">Уровень нефти Q (%):</span>
          <span id="oilQ">0</span>
        </div>
      </div>
    </aside>

    <!-- Центральная панель: Цифровой двойник -->
    <main class="main">
      <div class="title">Цифровой двойник</div>
      <div class="sim-area">
        <!-- Сепаратор -->
        <div class="separator" id="separator">
          <div class="phase-layer water" id="waterLayer" style="height:30%;"></div>
          <div class="phase-layer oil" id="oilLayer" style="height:30%;"></div>
          <div class="phase-layer gas" id="gasLayer" style="height:40%;"></div>
          
          <!-- Вертикальная перегородка -->
          <div class="separator-baffle" id="separatorBaffle"></div>
          
          <!-- Секция после перегородки (только нефть) -->
          <div class="phase-layer oil-after-baffle" id="oilLayerAfterBaffle" style="height:0%;"></div>
        </div>

        <!-- Насос -->
        <div class="pump" id="pump">+</div>

        <!-- Трубопроводы (SVG для цельных линий) -->
        <svg class="pipes-svg" viewBox="0 0 1000 600" preserveAspectRatio="none">
          <defs>
            <!-- Градиенты для труб -->
            <linearGradient id="pipeBlueGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#1556d6;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#0c3faf;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="pipeBlackGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#1a1a1a;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#0a0a0a;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="pipeYellowGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#d4b000;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#c0a000;stop-opacity:1" />
            </linearGradient>
            <linearGradient id="pipeInletGrad" x1="0%" y1="0%" x2="0%" y2="100%">
              <stop offset="0%" style="stop-color:#d0d8e2;stop-opacity:1" />
              <stop offset="100%" style="stop-color:#b9c2cf;stop-opacity:1" />
            </linearGradient>
            
            <!-- Анимация потока -->
            <pattern id="flowBlue" x="0" y="0" width="30" height="14" patternUnits="userSpaceOnUse">
              <rect width="15" height="14" fill="rgba(255,255,255,0.1)"/>
              <rect x="15" width="15" height="14" fill="transparent"/>
              <animateTransform attributeName="patternTransform" type="translate" from="0 0" to="30 0" dur="1s" repeatCount="indefinite"/>
            </pattern>
            <pattern id="flowBlack" x="0" y="0" width="30" height="14" patternUnits="userSpaceOnUse">
              <rect width="15" height="14" fill="rgba(255,255,255,0.18)"/>
              <rect x="15" width="15" height="14" fill="transparent"/>
              <animateTransform attributeName="patternTransform" type="translate" from="0 0" to="30 0" dur="1s" repeatCount="indefinite"/>
            </pattern>
            <pattern id="flowYellow" x="0" y="0" width="30" height="14" patternUnits="userSpaceOnUse">
              <rect width="15" height="14" fill="rgba(255,255,255,0.2)"/>
              <rect x="15" width="15" height="14" fill="transparent"/>
              <animateTransform attributeName="patternTransform" type="translate" from="0 0" to="30 0" dur="1s" repeatCount="indefinite"/>
            </pattern>
          </defs>
          
          <!-- Входная труба -->
          <g id="inletPipeSvg">
            <path d="M 10 336 L 160 336" stroke="url(#pipeInletGrad)" stroke-width="14" fill="none" stroke-linecap="round"/>
            <path class="flow-line" d="M 10 336 L 160 336" stroke="url(#flowBlue)" stroke-width="14" fill="none" stroke-linecap="round" opacity="0"/>
          </g>
          
          <!-- Водяная линия (цельная L-образная труба) -->
          <g id="waterPipeSvg">
            <path d="M 200 516 L 460 516 L 460 456 L 620 456" 
                  stroke="url(#pipeBlueGrad)" stroke-width="14" fill="none" 
                  stroke-linecap="round" stroke-linejoin="round"/>
            <path class="flow-line water-flow" 
                  d="M 200 516 L 460 516 L 460 456 L 620 456" 
                  stroke="url(#flowBlue)" stroke-width="14" fill="none" 
                  stroke-linecap="round" stroke-linejoin="round" opacity="0"/>
          </g>
          
          <!-- Нефтяная линия (цельная L-образная труба) -->
          <g id="oilPipeSvg">
            <path d="M 780 504 L 700 504 L 700 456 L 540 456" 
                  stroke="url(#pipeBlackGrad)" stroke-width="14" fill="none" 
                  stroke-linecap="round" stroke-linejoin="round"/>
            <path class="flow-line oil-flow" 
                  d="M 780 504 L 700 504 L 700 456 L 540 456" 
                  stroke="url(#flowBlack)" stroke-width="14" fill="none" 
                  stroke-linecap="round" stroke-linejoin="round" opacity="0"/>
          </g>
          
          <!-- Газовая линия (цельная L-образная труба) -->
          <g id="gasPipeSvg">
            <path d="M 820 132 L 700 132 L 700 168 L 540 168" 
                  stroke="url(#pipeYellowGrad)" stroke-width="14" fill="none" 
                  stroke-linecap="round" stroke-linejoin="round"/>
            <path class="flow-line gas-flow" 
                  d="M 820 132 L 700 132 L 700 168 L 540 168" 
                  stroke="url(#flowYellow)" stroke-width="14" fill="none" 
                  stroke-linecap="round" stroke-linejoin="round" opacity="0"/>
          </g>
        </svg>
        
        <!-- Входная труба (для совместимости с существующим кодом) -->
        <div class="pipe" id="inletPipe" style="left: 1%; top: 56%; width: 15%; height: 14px; opacity: 0;">
          <div class="flow"></div>
        </div>
        
        <!-- Водяная линия (скрытые div'ы для совместимости) -->
        <div class="pipe pipe-blue" id="waterPipe" style="left: 20%; bottom: 14%; width: 26%; height: 14px; opacity: 0;">
          <div class="flow"></div>
        </div>
        <div class="pipe vertical pipe-blue" style="left: 46%; bottom: 14%; height: 90px; opacity: 0;">
          <div class="flow"></div>
        </div>
        <div class="pipe pipe-blue" id="waterPipe2" style="left: 46%; bottom: 24%; width: 16%; height: 14px; opacity: 0;">
          <div class="flow"></div>
        </div>
        
        <!-- Нефтяная линия (скрытые div'ы для совместимости) -->
        <div class="pipe pipe-black" id="oilPipe" style="right: 8%; bottom: 16%; width: 22%; height: 14px; opacity: 0;">
          <div class="flow"></div>
        </div>
        <div class="pipe vertical pipe-black" style="right: 30%; bottom: 16%; height: 90px; opacity: 0;">
          <div class="flow"></div>
        </div>
        <div class="pipe pipe-black" id="oilPipe2" style="right: 30%; bottom: 24%; width: 16%; height: 14px; opacity: 0;">
          <div class="flow"></div>
        </div>
        
        <!-- Газовая линия (скрытые div'ы для совместимости) -->
        <div class="pipe pipe-yellow" id="gasPipe" style="right: 12%; top: 22%; width: 18%; height: 14px; opacity: 0;">
          <div class="flow"></div>
        </div>
        <div class="pipe vertical pipe-yellow" style="right: 30%; top: 22%; height: 50px; opacity: 0;">
          <div class="flow"></div>
        </div>
        <div class="pipe pipe-yellow" id="gasPipe2" style="right: 30%; top: 28%; width: 16%; height: 14px; opacity: 0;">
          <div class="flow"></div>
        </div>

        <!-- Клапаны -->
        <div class="valve open" id="waterValve" style="left: 40%; bottom: 14%;">H2O</div>

        <div class="valve open" id="oilValve" style="right: 22%; bottom: 16%;">Oil</div>

        <div class="valve open" id="gasValve" style="right: 22%; top: 16%;">Gas</div>

        <!-- Алерт -->
        <div class="alert" id="alertBox">Авария</div>
      </div>
    </main>

    <!-- Правая панель: Рекомендации -->
    <aside class="recommendations">
      <h2>Рекомендации</h2>
      <div id="recommendationContent" class="recommendation-content">
        <div class="status-badge normal">ЗАГРУЗКА</div>
        <h3>Инициализация системы...</h3>
        <p>Пожалуйста, подождите.</p>
      </div>
      
      <!-- Показатели -->
      <div class="readouts">
        <div class="pill">Газ: <span id="gasLevelText">40%</span></div>
        <div class="pill">Нефть: <span id="oilLevelText">30%</span></div>
        <div class="pill">Вода: <span id="waterLevelText">30%</span></div>
        <div class="pill">Расход на входе: <span id="inletFlowText">200 м³/сут</span></div>
      </div>
      
    </aside>
  </div>

  <!-- Подключение модулей -->
  <script src="js/model.js"></script>
  <script src="js/view.js"></script>
  <script src="js/controller.js"></script>
  
  <!-- Инициализация приложения -->
  <script>
    // Создание экземпляров компонентов
    const model = new SeparatorModel();
    const view = new SeparatorView();
    const controller = new SeparatorController(model, view);
  </script>
</body>
</html>
